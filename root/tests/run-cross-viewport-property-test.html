<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cross-Viewport Property Test Runner</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-header {
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 16px;
            margin-bottom: 24px;
        }
        .property-info {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 20px;
        }
        .run-tests-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 20px;
        }
        .run-tests-btn:hover {
            background: #2563eb;
        }
        .run-tests-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        .console-output {
            background: #1f2937;
            color: #f9fafb;
            padding: 16px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
            white-space: pre-wrap;
        }
        .test-results {
            margin-top: 20px;
        }
        .test-result {
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
            border-left: 4px solid;
        }
        .test-pass {
            background: #f0fdf4;
            border-left-color: #22c55e;
        }
        .test-fail {
            background: #fef2f2;
            border-left-color: #ef4444;
        }
        .summary-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 20px;
            margin-top: 20px;
        }
        .counter-example {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 4px;
            padding: 12px;
            margin-top: 8px;
            font-family: monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>Cross-Viewport Property Test Runner</h1>
            <p>Testing functionality and layout across mobile, tablet, and desktop viewports.</p>
            <button class="run-tests-btn" id="runTestsBtn" onclick="runPropertyTests()">Run Property Tests</button>
        </div>

        <div class="property-info">
            <h3>Property 18: Cross-Viewport Testing</h3>
            <p><strong>Feature:</strong> design-system-migration</p>
            <p><strong>Validates:</strong> Requirements 14.3</p>
            <p><strong>Description:</strong> For any page in the application, functionality and layout should work correctly across mobile (320px-639px), tablet (640px-1023px), and desktop (1024px+) viewports.</p>
        </div>

        <div class="console-output" id="consoleOutput" style="display: none;"></div>

        <div class="test-results" id="testResults"></div>

        <div class="summary-card" id="summaryCard" style="display: none;">
            <h3>Test Summary</h3>
            <div id="summaryContent"></div>
        </div>

        <div id="pbt-results"></div>
    </div>

    <script src="cross-viewport-property.test.js"></script>
    
    <script>
        let consoleOutput = [];

        // Override console.log to capture output
        const originalConsoleLog = console.log;
        console.log = function(...args) {
            const message = args.join(' ');
            consoleOutput.push(message);
            
            const consoleElement = document.getElementById('consoleOutput');
            if (consoleElement.style.display !== 'none') {
                consoleElement.textContent = consoleOutput.join('\n');
                consoleElement.scrollTop = consoleElement.scrollHeight;
            }
            
            originalConsoleLog.apply(console, args);
        };

        async function runPropertyTests() {
            const runButton = document.getElementById('runTestsBtn');
            const consoleOutputDiv = document.getElementById('consoleOutput');
            const testResults = document.getElementById('testResults');
            const summaryCard = document.getElementById('summaryCard');
            
            // Reset UI
            runButton.disabled = true;
            runButton.textContent = 'Running Tests...';
            consoleOutputDiv.style.display = 'block';
            testResults.innerHTML = '';
            summaryCard.style.display = 'none';
            consoleOutput = [];
            
            try {
                const runner = new CrossViewportTestRunner();
                const results = await runner.runAllTests();
                
                // Display individual test results
                results.forEach(result => {
                    displayTestResult(result.name, result);
                });
                
                // Display summary
                displaySummary(results);
                
            } catch (error) {
                console.log(`❌ Error running tests: ${error.message}`);
            }
            
            // Re-enable button
            runButton.disabled = false;
            runButton.textContent = 'Run Property Tests Again';
        }

        function displayTestResult(testName, result) {
            const resultsContainer = document.getElementById('testResults');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${result.passed ? 'test-pass' : 'test-fail'}`;
            
            let content = `
                <h4>${testName}</h4>
                <p><strong>Status:</strong> ${result.passed ? '✅ PASSED' : '❌ FAILED'}</p>
                <p><strong>Iterations:</strong> ${result.passed ? result.iterations : result.failedAt}/${result.iterations || 100}</p>
            `;
            
            if (!result.passed) {
                if (result.counterExample) {
                    content += `
                        <div class="counter-example">
                            <strong>Counter-example:</strong><br>
                            ${JSON.stringify(result.counterExample, null, 2)}
                        </div>
                    `;
                }
                if (result.error) {
                    content += `<p><strong>Error:</strong> ${result.error}</p>`;
                }
            }
            
            resultDiv.innerHTML = content;
            resultsContainer.appendChild(resultDiv);
        }

        function displaySummary(results) {
            const summaryCard = document.getElementById('summaryCard');
            const summaryContent = document.getElementById('summaryContent');
            
            const totalTests = results.length;
            const passedTests = results.filter(r => r.passed).length;
            const failedTests = totalTests - passedTests;
            const successRate = Math.round((passedTests / totalTests) * 100);
            
            summaryContent.innerHTML = `
                <p><strong>Current Viewport:</strong> ${window.innerWidth}px × ${window.innerHeight}px</p>
                <p><strong>Viewport Category:</strong> ${getCurrentViewportCategory()}</p>
                <p><strong>Total Property Tests:</strong> ${totalTests}</p>
                <p><strong>Passed:</strong> ${passedTests}</p>
                <p><strong>Failed:</strong> ${failedTests}</p>
                <p><strong>Success Rate:</strong> ${successRate}%</p>
                
                ${successRate >= 90 ? 
                    '<p style="color: #22c55e; font-weight: bold;">✅ Excellent cross-viewport compatibility!</p>' : 
                    successRate >= 75 ?
                    '<p style="color: #f59e0b; font-weight: bold;">⚠️ Good viewport compatibility with minor issues.</p>' :
                    '<p style="color: #ef4444; font-weight: bold;">❌ Significant viewport compatibility issues detected.</p>'
                }
            `;
            
            summaryCard.style.display = 'block';
        }

        function getCurrentViewportCategory() {
            const width = window.innerWidth;
            if (width >= 320 && width <= 639) return 'Mobile';
            if (width >= 640 && width <= 1023) return 'Tablet';
            if (width >= 1024) return 'Desktop';
            return 'Unknown';
        }

        // Auto-run tests when page loads
        window.addEventListener('load', () => {
            setTimeout(() => {
                console.log('Auto-running cross-viewport property tests...');
                runPropertyTests();
            }, 1000);
        });
    </script>
</body>
</html>