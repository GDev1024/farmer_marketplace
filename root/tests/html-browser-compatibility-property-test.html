<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Property Test: HTML and Browser Compatibility</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-header {
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 16px;
            margin-bottom: 24px;
        }
        .property-info {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 20px;
        }
        .browser-info {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 20px;
        }
        .test-progress {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 16px;
            margin: 20px 0;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: #22c55e;
            transition: width 0.3s ease;
        }
        .test-results {
            margin-top: 20px;
        }
        .test-result {
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
            border-left: 4px solid;
        }
        .test-pass {
            background: #f0fdf4;
            border-left-color: #22c55e;
        }
        .test-fail {
            background: #fef2f2;
            border-left-color: #ef4444;
        }
        .run-tests-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 20px;
        }
        .run-tests-btn:hover {
            background: #2563eb;
        }
        .run-tests-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        .console-output {
            background: #1f2937;
            color: #f9fafb;
            padding: 16px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
        }
        .summary-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 20px;
            margin-top: 20px;
        }
        .counter-example {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 4px;
            padding: 12px;
            margin-top: 8px;
            font-family: monospace;
            font-size: 14px;
        }
        .feature-support {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin: 16px 0;
        }
        .feature-item {
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
        }
        .feature-supported {
            background: #d1fae5;
            color: #065f46;
        }
        .feature-unsupported {
            background: #fee2e2;
            color: #991b1b;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>Property-Based Test: HTML and Browser Compatibility</h1>
            <p>Testing HTML5 compliance and cross-browser compatibility for all pages.</p>
            <button class="run-tests-btn" id="runTestsBtn" onclick="runPropertyTests()">Run Property Tests</button>
        </div>

        <div class="property-info">
            <h3>Property 17: HTML and Browser Compatibility</h3>
            <p><strong>Feature:</strong> design-system-migration</p>
            <p><strong>Validates:</strong> Requirements 14.2, 14.4</p>
            <p><strong>Description:</strong> For any page in the application, HTML should pass HTML5 validation and work correctly across all major browsers (Chrome, Firefox, Safari, Edge).</p>
        </div>

        <div class="browser-info" id="browserInfo">
            <h4>Current Browser Environment</h4>
            <div id="browserDetails"></div>
        </div>

        <div class="test-progress" id="testProgress" style="display: none;">
            <h4>Test Progress</h4>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
            </div>
            <p id="progressText">Preparing tests...</p>
        </div>

        <div class="console-output" id="consoleOutput" style="display: none;"></div>

        <div class="test-results" id="testResults"></div>

        <div class="summary-card" id="summaryCard" style="display: none;">
            <h3>Test Summary</h3>
            <div id="summaryContent"></div>
        </div>
    </div>

    <script>
        let testResults = [];
        let consoleOutput = [];
        let browserInfo = {};

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            consoleOutput.push(logEntry);
            
            const consoleElement = document.getElementById('consoleOutput');
            if (consoleElement.style.display !== 'none') {
                consoleElement.innerHTML = consoleOutput.join('\n');
                consoleElement.scrollTop = consoleElement.scrollHeight;
            }
            
            console.log(message);
        }

        // Detect browser information
        function detectBrowser() {
            const userAgent = navigator.userAgent;
            const info = {
                name: 'Unknown',
                version: 'Unknown',
                engine: 'Unknown',
                platform: navigator.platform,
                language: navigator.language,
                cookieEnabled: navigator.cookieEnabled,
                onLine: navigator.onLine
            };

            if (userAgent.includes('Chrome') && !userAgent.includes('Edg')) {
                info.name = 'Chrome';
                info.version = userAgent.match(/Chrome\/([0-9.]+)/)?.[1] || 'Unknown';
                info.engine = 'Blink';
            } else if (userAgent.includes('Firefox')) {
                info.name = 'Firefox';
                info.version = userAgent.match(/Firefox\/([0-9.]+)/)?.[1] || 'Unknown';
                info.engine = 'Gecko';
            } else if (userAgent.includes('Safari') && !userAgent.includes('Chrome')) {
                info.name = 'Safari';
                info.version = userAgent.match(/Version\/([0-9.]+)/)?.[1] || 'Unknown';
                info.engine = 'WebKit';
            } else if (userAgent.includes('Edg')) {
                info.name = 'Edge';
                info.version = userAgent.match(/Edg\/([0-9.]+)/)?.[1] || 'Unknown';
                info.engine = 'Blink';
            }

            return info;
        }

        function displayBrowserInfo() {
            browserInfo = detectBrowser();
            const browserDetails = document.getElementById('browserDetails');
            
            browserDetails.innerHTML = `
                <p><strong>Browser:</strong> ${browserInfo.name} ${browserInfo.version}</p>
                <p><strong>Engine:</strong> ${browserInfo.engine}</p>
                <p><strong>Platform:</strong> ${browserInfo.platform}</p>
                <p><strong>Language:</strong> ${browserInfo.language}</p>
                <p><strong>Cookies:</strong> ${browserInfo.cookieEnabled ? 'Enabled' : 'Disabled'}</p>
                <p><strong>Online:</strong> ${browserInfo.onLine ? 'Yes' : 'No'}</p>
            `;
        }

        // Property-based test framework
        class PropertyTest {
            constructor(name, generator, property, iterations = 100) {
                this.name = name;
                this.generator = generator;
                this.property = property;
                this.iterations = iterations;
            }

            async run() {
                log(`üß™ Running property test: ${this.name}`);
                const results = [];
                
                for (let i = 0; i < this.iterations; i++) {
                    try {
                        const testData = this.generator();
                        const result = await this.property(testData);
                        results.push({ iteration: i + 1, passed: result, data: testData });
                        
                        if (!result) {
                            log(`‚ùå Property failed at iteration ${i + 1}: ${JSON.stringify(testData)}`);
                            return { 
                                passed: false, 
                                failedAt: i + 1, 
                                counterExample: testData, 
                                results,
                                totalIterations: this.iterations
                            };
                        }
                        
                        // Update progress
                        updateProgress(i + 1, this.iterations, `${this.name} - Iteration ${i + 1}/${this.iterations}`);
                        
                        // Small delay to show progress
                        if (i % 10 === 0) {
                            await new Promise(resolve => setTimeout(resolve, 10));
                        }
                    } catch (error) {
                        log(`üí• Error at iteration ${i + 1}: ${error.message}`);
                        return { 
                            passed: false, 
                            failedAt: i + 1, 
                            error: error.message, 
                            results,
                            totalIterations: this.iterations
                        };
                    }
                }
                
                log(`‚úÖ Property passed all ${this.iterations} iterations`);
                return { 
                    passed: true, 
                    iterations: this.iterations, 
                    results,
                    totalIterations: this.iterations
                };
            }
        }

        // Test data generators
        const generators = {
            htmlElement: () => {
                const elements = [
                    { tag: 'div', attributes: { class: 'container' } },
                    { tag: 'button', attributes: { type: 'button', class: 'btn btn-primary' } },
                    { tag: 'input', attributes: { type: 'email', required: true } },
                    { tag: 'form', attributes: { method: 'POST', action: 'submit.php' } },
                    { tag: 'nav', attributes: { role: 'navigation' } },
                    { tag: 'header', attributes: { class: 'page-header' } },
                    { tag: 'main', attributes: { class: 'page-main' } },
                    { tag: 'footer', attributes: { class: 'page-footer' } },
                    { tag: 'article', attributes: { class: 'card' } },
                    { tag: 'section', attributes: { class: 'hero-section' } }
                ];
                return elements[Math.floor(Math.random() * elements.length)];
            },

            cssFeature: () => {
                const features = [
                    { name: 'flexbox', property: 'display', value: 'flex' },
                    { name: 'grid', property: 'display', value: 'grid' },
                    { name: 'custom-properties', property: '--test-var', value: 'red' },
                    { name: 'border-radius', property: 'border-radius', value: '8px' },
                    { name: 'box-shadow', property: 'box-shadow', value: '0 2px 4px rgba(0,0,0,0.1)' },
                    { name: 'transform', property: 'transform', value: 'translateX(10px)' },
                    { name: 'transition', property: 'transition', value: 'all 0.3s ease' },
                    { name: 'media-queries', property: '@media', value: '(min-width: 768px)' }
                ];
                return features[Math.floor(Math.random() * features.length)];
            },

            jsFeature: () => {
                const features = [
                    { name: 'arrow-functions', test: () => (() => true)() },
                    { name: 'const-let', test: () => { try { eval('const x = 1; let y = 2;'); return true; } catch { return false; } } },
                    { name: 'promises', test: () => typeof Promise !== 'undefined' },
                    { name: 'fetch', test: () => typeof fetch !== 'undefined' },
                    { name: 'local-storage', test: () => typeof localStorage !== 'undefined' },
                    { name: 'session-storage', test: () => typeof sessionStorage !== 'undefined' },
                    { name: 'geolocation', test: () => typeof navigator.geolocation !== 'undefined' },
                    { name: 'web-workers', test: () => typeof Worker !== 'undefined' }
                ];
                return features[Math.floor(Math.random() * features.length)];
            },

            htmlValidation: () => {
                const validations = [
                    { type: 'doctype', check: () => document.doctype && document.doctype.name.toLowerCase() === 'html' },
                    { type: 'charset', check: () => document.querySelector('meta[charset]') !== null },
                    { type: 'viewport', check: () => document.querySelector('meta[name="viewport"]') !== null },
                    { type: 'title', check: () => document.title && document.title.length > 0 },
                    { type: 'lang', check: () => document.documentElement.hasAttribute('lang') },
                    { type: 'semantic-structure', check: () => document.querySelector('main') !== null },
                    { type: 'form-labels', check: () => validateFormLabels() },
                    { type: 'image-alt', check: () => validateImageAlt() }
                ];
                return validations[Math.floor(Math.random() * validations.length)];
            }
        };

        // Property test implementations
        const propertyTests = [
            new PropertyTest(
                "HTML Element Compatibility",
                generators.htmlElement,
                async (elementData) => {
                    // Property: All HTML elements should be supported and render correctly
                    try {
                        const element = document.createElement(elementData.tag);
                        
                        // Set attributes
                        Object.entries(elementData.attributes).forEach(([key, value]) => {
                            element.setAttribute(key, value);
                        });
                        
                        // Check if element is recognized (not HTMLUnknownElement)
                        const isSupported = element.toString() !== '[object HTMLUnknownElement]';
                        
                        // Check if attributes are set correctly
                        const attributesSet = Object.entries(elementData.attributes).every(([key, value]) => 
                            element.getAttribute(key) === value
                        );
                        
                        return isSupported && attributesSet;
                    } catch (error) {
                        return false;
                    }
                },
                50
            ),

            new PropertyTest(
                "CSS Feature Compatibility",
                generators.cssFeature,
                async (cssFeature) => {
                    // Property: All CSS features should be supported or gracefully degrade
                    try {
                        if (cssFeature.name === 'media-queries') {
                            return typeof window.matchMedia !== 'undefined';
                        }
                        
                        if (cssFeature.name === 'custom-properties') {
                            return CSS.supports && CSS.supports('--test-var', 'red');
                        }
                        
                        return CSS.supports && CSS.supports(cssFeature.property, cssFeature.value);
                    } catch (error) {
                        return false;
                    }
                },
                50
            ),

            new PropertyTest(
                "JavaScript Feature Compatibility",
                generators.jsFeature,
                async (jsFeature) => {
                    // Property: JavaScript features should be supported or have fallbacks
                    try {
                        return jsFeature.test();
                    } catch (error) {
                        return false;
                    }
                },
                50
            ),

            new PropertyTest(
                "HTML5 Validation Compliance",
                generators.htmlValidation,
                async (validation) => {
                    // Property: HTML should pass validation checks
                    try {
                        return validation.check();
                    } catch (error) {
                        return false;
                    }
                },
                50
            )
        ];

        // Helper functions
        function validateFormLabels() {
            const inputs = document.querySelectorAll('input, select, textarea');
            if (inputs.length === 0) return true; // No forms to validate
            
            let validLabels = 0;
            inputs.forEach(input => {
                const id = input.id;
                const label = id ? document.querySelector(`label[for="${id}"]`) : null;
                const ariaLabel = input.getAttribute('aria-label');
                const ariaLabelledBy = input.getAttribute('aria-labelledby');
                
                if (label || ariaLabel || ariaLabelledBy) {
                    validLabels++;
                }
            });
            
            return validLabels >= inputs.length * 0.8; // 80% of inputs should have labels
        }

        function validateImageAlt() {
            const images = document.querySelectorAll('img');
            if (images.length === 0) return true; // No images to validate
            
            let validAlt = 0;
            images.forEach(img => {
                if (img.hasAttribute('alt')) {
                    validAlt++;
                }
            });
            
            return validAlt >= images.length * 0.9; // 90% of images should have alt text
        }

        // UI functions
        function updateProgress(current, total, message) {
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            const percentage = (current / total) * 100;
            progressFill.style.width = `${percentage}%`;
            progressText.textContent = message;
        }

        function displayTestResult(testName, result) {
            const resultsContainer = document.getElementById('testResults');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${result.passed ? 'test-pass' : 'test-fail'}`;
            
            let content = `
                <h4>${testName}</h4>
                <p><strong>Status:</strong> ${result.passed ? '‚úÖ PASSED' : '‚ùå FAILED'}</p>
                <p><strong>Iterations:</strong> ${result.passed ? result.iterations : result.failedAt}/${result.totalIterations}</p>
                <p><strong>Browser:</strong> ${browserInfo.name} ${browserInfo.version}</p>
            `;
            
            if (!result.passed) {
                if (result.counterExample) {
                    content += `
                        <div class="counter-example">
                            <strong>Counter-example:</strong><br>
                            ${JSON.stringify(result.counterExample, null, 2)}
                        </div>
                    `;
                }
                if (result.error) {
                    content += `<p><strong>Error:</strong> ${result.error}</p>`;
                }
            }
            
            resultDiv.innerHTML = content;
            resultsContainer.appendChild(resultDiv);
        }

        function displaySummary(results) {
            const summaryCard = document.getElementById('summaryCard');
            const summaryContent = document.getElementById('summaryContent');
            
            const totalTests = results.length;
            const passedTests = results.filter(r => r.passed).length;
            const failedTests = totalTests - passedTests;
            const successRate = Math.round((passedTests / totalTests) * 100);
            
            // Feature support analysis
            const featureSupport = analyzeFeatureSupport();
            
            summaryContent.innerHTML = `
                <p><strong>Browser:</strong> ${browserInfo.name} ${browserInfo.version} (${browserInfo.engine})</p>
                <p><strong>Total Property Tests:</strong> ${totalTests}</p>
                <p><strong>Passed:</strong> ${passedTests}</p>
                <p><strong>Failed:</strong> ${failedTests}</p>
                <p><strong>Success Rate:</strong> ${successRate}%</p>
                
                <h4>Feature Support Analysis</h4>
                <div class="feature-support">
                    ${featureSupport.map(feature => 
                        `<div class="feature-item ${feature.supported ? 'feature-supported' : 'feature-unsupported'}">
                            ${feature.name}: ${feature.supported ? '‚úÖ' : '‚ùå'}
                        </div>`
                    ).join('')}
                </div>
                
                ${successRate >= 90 ? 
                    '<p style="color: #22c55e; font-weight: bold;">‚úÖ Excellent HTML5 and browser compatibility!</p>' : 
                    successRate >= 75 ?
                    '<p style="color: #f59e0b; font-weight: bold;">‚ö†Ô∏è Good compatibility with minor issues.</p>' :
                    '<p style="color: #ef4444; font-weight: bold;">‚ùå Significant compatibility issues detected.</p>'
                }
            `;
            
            summaryCard.style.display = 'block';
        }

        function analyzeFeatureSupport() {
            return [
                { name: 'HTML5 Semantic Elements', supported: document.createElement('main').toString() !== '[object HTMLUnknownElement]' },
                { name: 'CSS Flexbox', supported: CSS.supports && CSS.supports('display', 'flex') },
                { name: 'CSS Grid', supported: CSS.supports && CSS.supports('display', 'grid') },
                { name: 'CSS Custom Properties', supported: CSS.supports && CSS.supports('--test', 'red') },
                { name: 'ES6 Arrow Functions', supported: (() => { try { eval('() => {}'); return true; } catch { return false; } })() },
                { name: 'Promises', supported: typeof Promise !== 'undefined' },
                { name: 'Fetch API', supported: typeof fetch !== 'undefined' },
                { name: 'Local Storage', supported: typeof localStorage !== 'undefined' },
                { name: 'Media Queries', supported: typeof window.matchMedia !== 'undefined' },
                { name: 'Form Validation', supported: document.createElement('input').checkValidity !== undefined }
            ];
        }

        async function runPropertyTests() {
            const runButton = document.getElementById('runTestsBtn');
            const testProgress = document.getElementById('testProgress');
            const consoleOutputDiv = document.getElementById('consoleOutput');
            const testResults = document.getElementById('testResults');
            
            // Reset UI
            runButton.disabled = true;
            runButton.textContent = 'Running Tests...';
            testProgress.style.display = 'block';
            consoleOutputDiv.style.display = 'block';
            testResults.innerHTML = '';
            consoleOutput = [];
            
            displayBrowserInfo();
            
            log('üß™ Starting HTML and Browser Compatibility Property Tests');
            log('Feature: design-system-migration, Property 17: HTML and Browser Compatibility');
            log('Validates: Requirements 14.2, 14.4');
            log(`Browser: ${browserInfo.name} ${browserInfo.version} (${browserInfo.engine})`);
            
            const results = [];
            
            for (let i = 0; i < propertyTests.length; i++) {
                const test = propertyTests[i];
                log(`\nüìã Running: ${test.name}`);
                
                const result = await test.run();
                results.push({ name: test.name, ...result });
                
                displayTestResult(test.name, result);
                
                // Small delay between tests
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            log('\nüìä All property tests completed');
            displaySummary(results);
            
            // Re-enable button
            runButton.disabled = false;
            runButton.textContent = 'Run Property Tests Again';
            testProgress.style.display = 'none';
            
            return results;
        }

        // Initialize
        window.addEventListener('load', () => {
            displayBrowserInfo();
            setTimeout(() => {
                log('Auto-running HTML and browser compatibility property tests...');
                runPropertyTests();
            }, 1000);
        });
    </script>
</body>
</html>