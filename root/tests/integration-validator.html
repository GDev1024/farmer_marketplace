<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integration Validator - Grenada Farmers Marketplace</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .validator-container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
        }
        .test-result {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 8px;
            border-radius: 4px;
        }
        .test-result.pass {
            background: #e8f5e8;
            color: #2d5016;
        }
        .test-result.fail {
            background: #ffe8e8;
            color: #d32f2f;
        }
        .test-icon {
            margin-right: 10px;
            font-size: 16px;
        }
        .score {
            font-size: 18px;
            font-weight: bold;
            margin: 15px 0;
        }
        .overall-score {
            font-size: 24px;
            text-align: center;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
        }
        .excellent { background: #e8f5e8; color: #2d5016; }
        .good { background: #fff3cd; color: #856404; }
        .fair { background: #f8d7da; color: #721c24; }
        .poor { background: #f5c6cb; color: #721c24; }
        button {
            background: #3d5a3a;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #2d4429;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="validator-container">
        <h1>üß™ Integration Validator</h1>
        <p>This tool validates the integration and consistency of all components and pages in the Grenada Farmers Marketplace.</p>
        
        <div class="controls">
            <button onclick="runAllTests()">Run All Tests</button>
            <button onclick="runNavigationTests()">Test Navigation</button>
            <button onclick="runPageTests()">Test Pages</button>
            <button onclick="runCSSTests()">Test CSS</button>
        </div>
        
        <div id="results"></div>
    </div>

    <script>
        let testResults = {};
        
        async function runAllTests() {
            document.getElementById('results').innerHTML = '<div class="loading">üîÑ Running comprehensive integration tests...</div>';
            
            testResults = {};
            
            await runNavigationTests();
            await runPageTests();
            await runCSSTests();
            await runVisualTests();
            
            generateFinalReport();
        }
        
        async function runNavigationTests() {
            const section = createTestSection('Navigation Consistency', 'nav-tests');
            
            const tests = [
                { name: 'Header exists', test: () => checkFileExists('../header.php') },
                { name: 'Footer exists', test: () => checkFileExists('../footer.php') },
                { name: 'Navigation brand present', test: () => checkContentInFile('../header.php', 'nav-brand') },
                { name: 'Mobile toggle present', test: () => checkContentInFile('../header.php', 'nav-toggle') },
                { name: 'Skip links present', test: () => checkContentInFile('../header.php', 'skip-links') },
                { name: 'ARIA labels present', test: () => checkContentInFile('../header.php', 'aria-label') },
                { name: 'Semantic footer', test: () => checkContentInFile('../footer.php', '<footer') }
            ];
            
            const results = await runTestSuite(tests);
            testResults.navigation = results;
            
            displayTestResults(section, results);
        }
        
        async function runPageTests() {
            const section = createTestSection('Page Structure', 'page-tests');
            
            const pages = [
                'landing.php', 'home.php', 'browse.php', 'cart.php',
                'checkout.php', 'messages.php', 'sell.php', 'listing.php',
                'orders.php', 'profile.php', 'login.php', 'register.php',
                'payment-success.php', 'payment-cancel.php'
            ];
            
            const tests = [];
            pages.forEach(page => {
                tests.push({
                    name: `${page} exists`,
                    test: () => checkFileExists(`../pages/${page}`)
                });
                tests.push({
                    name: `${page} has main tag`,
                    test: () => checkContentInFile(`../pages/${page}`, '<main')
                });
                tests.push({
                    name: `${page} has semantic structure`,
                    test: () => checkContentInFile(`../pages/${page}`, 'page-main')
                });
            });
            
            const results = await runTestSuite(tests);
            testResults.pages = results;
            
            displayTestResults(section, results);
        }
        
        async function runCSSTests() {
            const section = createTestSection('CSS Architecture', 'css-tests');
            
            const cssFiles = [
                '../assets/css/variables.css',
                '../assets/css/base.css',
                '../css/components.css',
                '../css/layout.css',
                '../css/marketplace.css'
            ];
            
            const tests = [];
            cssFiles.forEach(file => {
                tests.push({
                    name: `${file.split('/').pop()} exists`,
                    test: () => checkFileExists(file)
                });
            });
            
            // Test CSS content
            tests.push({
                name: 'Design tokens defined',
                test: () => checkContentInFile('../assets/css/variables.css', '--color-primary')
            });
            tests.push({
                name: 'Merriweather font loaded',
                test: () => checkContentInFile('../header.php', 'Merriweather')
            });
            tests.push({
                name: 'Component classes defined',
                test: () => checkContentInFile('../css/components.css', '.btn')
            });
            
            const results = await runTestSuite(tests);
            testResults.css = results;
            
            displayTestResults(section, results);
        }
        
        async function runVisualTests() {
            const section = createTestSection('Visual Continuity', 'visual-tests');
            
            const tests = [
                { name: 'Consistent branding', test: () => checkBranding() },
                { name: 'Color palette usage', test: () => checkColorPalette() },
                { name: 'Typography consistency', test: () => checkTypography() },
                { name: 'Spacing system', test: () => checkSpacingSystem() },
                { name: 'Component consistency', test: () => checkComponents() }
            ];
            
            const results = await runTestSuite(tests);
            testResults.visual = results;
            
            displayTestResults(section, results);
        }
        
        async function runTestSuite(tests) {
            const results = [];
            
            for (const test of tests) {
                try {
                    const passed = await test.test();
                    results.push({ name: test.name, passed });
                } catch (error) {
                    results.push({ name: test.name, passed: false, error: error.message });
                }
            }
            
            return results;
        }
        
        async function checkFileExists(path) {
            try {
                const response = await fetch(path, { method: 'HEAD' });
                return response.ok;
            } catch {
                return false;
            }
        }
        
        async function checkContentInFile(path, content) {
            try {
                const response = await fetch(path);
                if (!response.ok) return false;
                const text = await response.text();
                return text.includes(content);
            } catch {
                return false;
            }
        }
        
        async function checkBranding() {
            const headerCheck = await checkContentInFile('../header.php', 'üåæ');
            const footerCheck = await checkContentInFile('../footer.php', 'Grenada');
            return headerCheck && footerCheck;
        }
        
        async function checkColorPalette() {
            return await checkContentInFile('../assets/css/variables.css', '--color-primary');
        }
        
        async function checkTypography() {
            return await checkContentInFile('../header.php', 'Merriweather');
        }
        
        async function checkSpacingSystem() {
            return await checkContentInFile('../assets/css/variables.css', '--space-');
        }
        
        async function checkComponents() {
            const btnCheck = await checkContentInFile('../css/components.css', '.btn');
            const cardCheck = await checkContentInFile('../css/components.css', '.card');
            return btnCheck && cardCheck;
        }
        
        function createTestSection(title, id) {
            const section = document.createElement('div');
            section.className = 'test-section';
            section.id = id;
            section.innerHTML = `<h2>${title}</h2><div class="test-results"></div>`;
            document.getElementById('results').appendChild(section);
            return section;
        }
        
        function displayTestResults(section, results) {
            const container = section.querySelector('.test-results');
            const passed = results.filter(r => r.passed).length;
            const total = results.length;
            const score = Math.round((passed / total) * 100);
            
            let html = `<div class="score">Score: ${score}% (${passed}/${total})</div>`;
            
            results.forEach(result => {
                const className = result.passed ? 'pass' : 'fail';
                const icon = result.passed ? '‚úÖ' : '‚ùå';
                html += `
                    <div class="test-result ${className}">
                        <span class="test-icon">${icon}</span>
                        <span>${result.name}</span>
                        ${result.error ? `<span style="margin-left: 10px; font-size: 12px;">(${result.error})</span>` : ''}
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function generateFinalReport() {
            const scores = {};
            let totalScore = 0;
            let sectionCount = 0;
            
            Object.keys(testResults).forEach(section => {
                const results = testResults[section];
                const passed = results.filter(r => r.passed).length;
                const total = results.length;
                const score = Math.round((passed / total) * 100);
                scores[section] = score;
                totalScore += score;
                sectionCount++;
            });
            
            const overallScore = Math.round(totalScore / sectionCount);
            
            let scoreClass = 'poor';
            let message = '‚ùå POOR! Integration needs significant improvements.';
            
            if (overallScore >= 90) {
                scoreClass = 'excellent';
                message = 'üéâ EXCELLENT! Integration is highly successful.';
            } else if (overallScore >= 75) {
                scoreClass = 'good';
                message = '‚úÖ GOOD! Integration is mostly successful with minor issues.';
            } else if (overallScore >= 60) {
                scoreClass = 'fair';
                message = '‚ö†Ô∏è FAIR! Integration has some issues that need attention.';
            }
            
            const reportHtml = `
                <div class="overall-score ${scoreClass}">
                    <h2>üèÜ OVERALL INTEGRATION SCORE: ${overallScore}%</h2>
                    <p>${message}</p>
                    <div style="margin-top: 20px;">
                        ${Object.entries(scores).map(([section, score]) => 
                            `<div>${section.charAt(0).toUpperCase() + section.slice(1)}: ${score}%</div>`
                        ).join('')}
                    </div>
                    <p style="margin-top: 20px; font-size: 14px;">
                        Test completed at: ${new Date().toLocaleString()}
                    </p>
                </div>
            `;
            
            document.getElementById('results').insertAdjacentHTML('beforeend', reportHtml);
        }
        
        // Auto-run tests when page loads
        window.addEventListener('load', () => {
            setTimeout(runAllTests, 1000);
        });
    </script>
</body>
</html>